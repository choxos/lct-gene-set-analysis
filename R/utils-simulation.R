#' Generate Random Gene Names
#'
#' @description
#' Generates unique random gene identifiers in a standardized format. Useful
#' for creating synthetic datasets for simulation studies and testing.
#'
#' @param n Number of gene names to generate. Must be a positive integer.
#'
#' @return Character vector of length n containing unique gene identifiers.
#'   Each identifier has the format: 7 random letters + 6-digit number + 1 letter
#'   (e.g., "ABCDEFG012345Z").
#'
#' @details
#' Gene names are generated by combining:
#' \enumerate{
#'   \item 7 random uppercase letters
#'   \item A 6-digit random number (0-999999)
#'   \item 1 random uppercase letter
#' }
#' This format ensures extremely low probability of duplicates even for large n.
#'
#' @export
#' @examples
#' # Generate 10 gene names
#' genes <- generate_gene_names(10)
#' print(genes)
#'
#' # Check uniqueness
#' length(unique(genes)) == length(genes)  # Should be TRUE
#'
#' # Use in simulation
#' n_genes <- 100
#' gene_ids <- generate_gene_names(n_genes)
#'
#' # Create expression matrix with gene names
#' expression <- matrix(rnorm(n_genes * 20), nrow = n_genes)
#' rownames(expression) <- gene_ids
generate_gene_names <- function(n) {
  a <- do.call(paste0, replicate(7, sample(LETTERS, n, TRUE), FALSE))
  paste0(a, sprintf("%04d", sample(999999, n, TRUE)), sample(LETTERS, n, TRUE))
}

#' Simulate Gene Expression Data with Correlation Structure
#'
#' @description
#' Generates synthetic gene expression data with specified correlation structure
#' and mean differences between control and case groups. Designed for power
#' analysis, method evaluation, and testing LCT performance under known conditions.
#'
#' @param rho Correlation coefficient between genes. Must be between 0 and 1.
#'   Values close to 0 indicate independent genes; values close to 1 indicate
#'   highly correlated genes. Common values: 0.1 (weak), 0.5 (moderate), 0.9 (strong).
#' @param n_samples Total number of samples. Must equal n_controls + n_cases.
#' @param n_genes Number of genes to simulate. Typical range: 100-10000.
#' @param gamma Mean shift between groups. Added to case group mean. Represents
#'   effect size for differential expression. Common values: 0 (no effect),
#'   0.5 (small), 1.0 (medium), 2.0 (large).
#' @param n_controls Number of control samples (group 0).
#' @param n_cases Number of case samples (group 1).
#'
#' @return Matrix with n_genes rows and n_samples columns. Row names are random
#'   gene identifiers (from \code{generate_gene_names}). Values are non-negative
#'   expression levels (absolute values after simulation).
#'
#' @details
#' Data generation process:
#' \enumerate{
#'   \item Generate control group: multivariate normal with mean 0, correlation rho
#'   \item Generate case group: multivariate normal with mean 0+gamma, correlation rho
#'   \item Combine groups and take absolute values (mimic log-scale expression)
#'   \item Assign random gene names
#' }
#'
#' The correlation structure is compound symmetric (all pairwise correlations = rho).
#'
#' @note
#' Set \code{set.seed()} before calling for reproducible data generation.
#'
#' @seealso
#' \code{\link{run_LCT_simulation}} for running complete simulation studies,
#' \code{\link{generate_gene_names}} for gene identifier generation
#'
#' @export
#' @examples
#' # Simulate data with moderate correlation and medium effect
#' set.seed(42)
#' expression_data <- simulate_gene_expression(
#'   rho = 0.5,
#'   n_samples = 40,
#'   n_genes = 200,
#'   gamma = 1.0,
#'   n_controls = 20,
#'   n_cases = 20
#' )
#'
#' # Check dimensions
#' dim(expression_data)  # Should be 200 x 40
#'
#' # Verify mean difference
#' phenotype <- c(rep(0, 20), rep(1, 20))
#' mean_controls <- rowMeans(expression_data[, phenotype == 0])
#' mean_cases <- rowMeans(expression_data[, phenotype == 1])
#' mean(mean_cases - mean_controls)  # Should be approximately gamma
#'
#' \donttest{
#' # Simulate null data (no differential expression)
#' null_data <- simulate_gene_expression(
#'   rho = 0.3,
#'   n_samples = 30,
#'   n_genes = 100,
#'   gamma = 0,  # No mean difference
#'   n_controls = 15,
#'   n_cases = 15
#' )
#'
#' # Simulate strong effect with high correlation
#' strong_effect <- simulate_gene_expression(
#'   rho = 0.9,
#'   n_samples = 50,
#'   n_genes = 300,
#'   gamma = 2.0,  # Large effect
#'   n_controls = 25,
#'   n_cases = 25
#' )
#' }
simulate_gene_expression <- function(rho, n_samples, n_genes, gamma,
                                     n_controls, n_cases) {
  # Generate control group
  dat1 <- faux::rnorm_multi(
    n = n_genes,
    mu = rep(0, n_controls),
    sd = stats::rnorm(n_controls, 0, 1),
    r = rho,
    empirical = FALSE
  )

  # Generate case group with mean shift
  dat2 <- faux::rnorm_multi(
    n = n_genes,
    mu = rep(0 + gamma, n_cases),
    sd = stats::rnorm(n_cases, 0, 1),
    r = rho,
    empirical = FALSE
  )

  # Combine and format
  dat <- cbind(dat1, dat2)
  dat <- abs(dat)  # Mimic log-expression (non-negative)
  rownames(dat) <- generate_gene_names(n_genes)

  return(dat)
}
